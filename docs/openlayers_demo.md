# OpenLayers demo

This demo renders **vector bathymetric contours (MVT)** and optional **raster overlays**
generated by `obfuscate_bathy_tiles.py`.

## Files
- `demo/openlayers.html` – the demo page
- `demo/server.py` – a tiny FastAPI tile server

## 1) Generate tiles
```bash
python obfuscate_bathy_tiles.py config.json
```

## 2) Start the demo tile server
```bash
python -m venv .venv
source .venv/bin/activate
pip install -r demo/requirements.txt
python demo/server.py
```

## 3) Open the demo page
Open `demo/openlayers.html` in your browser.

## Endpoints expected
- `/tiles/vector/{z}/{x}/{y}.pbf` (MVT)
- `/tiles/bathy/{z}/{x}/{y}.png` (PNG8)
- `/tiles/hillshade/{z}/{x}/{y}.png` (PNG8)
- `/tiles/slope/{z}/{x}/{y}.png` (PNG8)

## Extending the OpenLayers demo

### A) Contour style
In `openlayers.html`, the style is currently a simple stroke:
```js
style: new Style({ stroke: new Stroke({ width: 1.0 }) })
```
You can implement a `styleFunction` to vary width by `depth_m`.

### B) Reading bathy raster values client-side
If you need client-side processing, you can fetch PNG tiles and decode pixel values:
- mapping is linear between `vmin`..`vmax`
- 0 is nodata (masked land or missing)

For more advanced processing, consider emitting a quantized grid in MVT (embedded mode) or a separate binary endpoint.

### C) Adding interactions
OpenLayers supports `map.on('click', ...)` with feature picking on vector tiles.
You can display `depth_m` at the clicked contour line.

## Troubleshooting
- Black/empty bathy tiles usually means your `vmin/vmax` range is too wide; adjust config scaling.
- If the demo loads OSM but not tiles, check `demo/server.py` is running and the base URL matches.
