# FastAPI tile server

`demo/server.py` is a tiny **read-only** tile server that reads MBTiles (SQLite) and serves tiles
with the exact URL schema required by the MapLibre/OpenLayers demos. The server is configured
by `demo/config.json` (or via `DEMO_CONFIG=/path/to/config.json`).

## Endpoints
- `GET /` – demo landing page (static content)
- `GET /health` – quick diagnostics
- `GET /tiles/vector/{z}/{x}/{y}.pbf` – vector tiles (MVT)
- `GET /tiles/bathy/{z}/{x}/{y}.png` – bathy raster tiles (PNG8)
- `GET /tiles/hillshade/{z}/{x}/{y}.png` – hillshade tiles (PNG8)
- `GET /tiles/slope/{z}/{x}/{y}.png` – slope tiles (PNG8)
- `GET /tilejson/{name}` – serves `*.tilejson` from the configured tilejson directory

## Run
```bash
python -m venv .venv
source .venv/bin/activate
pip install -r demo/requirements.txt
python demo/server.py
```

Defaults (from `demo/config.json`):
- host: `127.0.0.1`
- port: `8080`
- public directory: `./demo/public`

Override the config path:
```bash
DEMO_CONFIG=demo/config.json python demo/server.py
```

## Configure tile inputs
Edit `demo/config.json` to point at the MBTiles generated by `config.json` or
`examples/config-demo.json`:
```json
{
  "tiles": {
    "vector_mbtiles": "./data/output/bathy_contours.mbtiles",
    "bathy_mbtiles": "./data/output/bathy_raster.mbtiles",
    "hillshade_mbtiles": "./data/output/bathy_hillshade.mbtiles",
    "slope_mbtiles": "./data/output/bathy_slope.mbtiles",
    "tilejson_dir": "./data/output/tilejson"
  },
  "public_dir": "./demo/public"
}
```

## Implementation notes
- MBTiles store tiles using **TMS Y indexing**.
- Web clients request tiles using **XYZ Y indexing**.
- The server converts `y_xyz` to `y_tms` with: `(2^z - 1) - y_xyz`.
- Vector tiles are gzip-compressed on the fly and served with `Content-Encoding: gzip`.

## Extending for production
Consider adding:
- stronger caching headers (ETag), CDN, and HTTP/2
- request logging and metrics
- range support and/or streaming
- precompressed vector tiles (store gzipped blobs)
- authentication/authorization for restricted datasets
